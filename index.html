<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zootube | Auto Refresh Mode</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- 1. VARIABLES & RESET --- */
        :root {
            --bg-body: #0f0f0f;
            --bg-surface: #1e1e1e;
            --primary: #3ea6ff;
            --gold: linear-gradient(45deg, #FFD700, #FFAA00);
            --text-main: #fff;
            --text-sec: #aaa;
            --border: rgba(255,255,255,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-body); color: var(--text-main); overflow-x: hidden; padding-bottom: 60px; }

        html { scroll-behavior: smooth; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }

        /* --- 2. HEADER --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 56px;
            background: rgba(15, 15, 15, 0.98); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px; z-index: 1000; border-bottom: 1px solid var(--border);
        }

        .left { display: flex; align-items: center; gap: 15px; }
        .menu-btn { font-size: 18px; color: white; cursor: pointer; }

        .brand { display: flex; flex-direction: column; justify-content: center; cursor: pointer; user-select: none; }
        .brand:active { opacity: 0.7; transform: scale(0.98); }
        
        .logo-img { height: 22px; width: auto; object-fit: contain; }
        .maker-badge {
            font-size: 8px; font-weight: 900; letter-spacing: 0.5px;
            text-transform: uppercase; margin-top: 2px;
            background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .search-wrap { flex: 1; max-width: 600px; margin: 0 20px; display: flex; align-items: center; gap: 10px; }
        .search-box { 
            display: flex; width: 100%; background: #121212; border: 1px solid #303030; 
            border-radius: 40px; overflow: hidden; height: 40px; align-items: center;
        }
        .search-box input {
            flex: 1; background: transparent; border: none; color: white; padding: 0 16px; font-size: 16px; outline: none;
        }
        .search-btn {
            width: 60px; height: 100%; background: #222; border: none; border-left: 1px solid #303030; color: #aaa; cursor: pointer;
        }
        .mic-btn {
            width: 40px; height: 40px; background: #181818; border-radius: 50%; border: none; 
            color: white; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }

        .right { display: flex; align-items: center; gap: 15px; }
        .icon-btn { font-size: 20px; color: white; background: none; border: none; cursor: pointer; }
        
        .avatar { 
            width: 32px; height: 32px; border-radius: 50%; 
            background: linear-gradient(135deg, #FF512F, #DD2476); 
            color: white; display: grid; place-items: center; 
            font-weight: bold; font-size:14px; cursor: pointer; overflow: hidden;
        }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }

        /* --- 3. MOBILE NAV --- */
        .bottom-nav {
            display: none; position: fixed; bottom: 0; left: 0; width: 100%; height: 55px;
            background: var(--bg-body); border-top: 1px solid var(--border);
            z-index: 999; justify-content: space-around; align-items: center;
        }
        .nav-btn {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: var(--text-sec); background: none; border: none; width: 100%; padding: 5px;
        }
        .nav-btn.active { color: white; }
        .nav-btn i { font-size: 20px; }
        .nav-btn span { font-size: 10px; }

        /* --- 4. SIDEBAR --- */
        .sidebar {
            width: 240px; position: fixed; top: 56px; left: 0; bottom: 0;
            background: var(--bg-body); overflow-y: auto; padding: 12px;
        }
        .side-item {
            display: flex; align-items: center; gap: 20px; padding: 10px 12px;
            color: white; text-decoration: none; border-radius: 10px; font-size: 14px; margin-bottom: 2px;
        }
        .side-item:hover { background: var(--bg-hover); }
        .side-item.active { background: var(--bg-hover); font-weight: 500; }

        /* --- 5. MAIN AREA --- */
        .main { margin-left: 240px; margin-top: 56px; padding: 20px; }

        .chips {
            position: sticky; top: 56px; background: rgba(15,15,15,0.98); z-index: 10;
            padding: 12px 0; margin-bottom: 10px; overflow-x: auto; white-space: nowrap;
            display: flex; gap: 10px;
        }
        .chip {
            background: var(--bg-hover); color: white; border: none; padding: 6px 14px;
            border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: 0.2s;
        }
        .chip:hover { background: #3f3f3f; }
        .chip.active { background: white; color: black; }

        /* --- SHORTS SHELF --- */
        .shorts-container-home {
            margin-bottom: 20px; border-bottom: 4px solid #1e1e1e; padding-bottom: 15px;
        }
        .shorts-head { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; font-weight: bold; font-size: 20px; }
        .shorts-logo-icon { color: #ff0000; font-size: 22px; }

        .shorts-shelf {
            display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px;
            scroll-snap-type: x mandatory;
        }
        .short-card {
            min-width: 160px; aspect-ratio: 9/16; background: #222; border-radius: 12px;
            position: relative; overflow: hidden; cursor: pointer; flex-shrink: 0;
            scroll-snap-align: start; transition: transform 0.2s;
        }
        .short-card:hover { transform: scale(1.02); }
        .short-img { width: 100%; height: 100%; object-fit: cover; }
        .short-overlay-grad {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 50%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); pointer-events: none;
        }
        .short-title {
            position: absolute; bottom: 12px; left: 10px; right: 10px;
            font-size: 14px; font-weight: 600; color: white;
            line-height: 1.3; text-shadow: 0 1px 2px black;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }
        .views-cnt {
            position: absolute; bottom: 50px; left: 10px; font-size: 11px; font-weight: bold; color: #ddd;
        }

        /* --- VIDEO GRID --- */
        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px 16px;
        }

        /* --- VIDEO CARD --- */
        .card { cursor: pointer; display: flex; flex-direction: column; gap: 10px; }
        .thumb {
            position: relative; width: 100%; aspect-ratio: 16/9;
            border-radius: 12px; overflow: hidden; background: #000;
        }
        .thumb img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
        .card:hover img { transform: scale(1.03); }
        .duration {
            position: absolute; bottom: 6px; right: 6px;
            background: rgba(0,0,0,0.8); color: white;
            font-size: 12px; padding: 2px 4px; border-radius: 4px; font-weight: 600;
        }
        .meta { display: flex; gap: 12px; }
        .chn-ico { width: 36px; height: 36px; border-radius: 50%; background: #333; flex-shrink: 0; display: grid; place-items: center; }
        .info { display: flex; flex-direction: column; }
        .title {
            font-size: 16px; font-weight: 600; line-height: 1.3; color: white;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 4px;
        }
        .sub-txt { font-size: 13px; color: var(--text-sec); }

        /* --- RESPONSIVE OPTIMIZATION --- */
        @media (max-width: 768px) {
            header { padding: 0 10px; height: 50px; }
            .menu-btn, .search-wrap, .sidebar { display: none; }
            .main { margin-left: 0; margin-top: 50px; padding: 10px; }
            .chips { top: 50px; }
            .bottom-nav { display: flex; }
            .mob-search-btn { display: block !important; }
            .logo-img { height: 20px; }
            .grid { grid-template-columns: 1fr; gap: 15px; }

            .shorts-shelf { gap: 10px; padding-bottom: 5px; }
            .shorts-shelf::-webkit-scrollbar { display: none; }
            .short-card { min-width: 140px; width: 40vw; aspect-ratio: 9/16; border-radius: 10px; }
        }
        .mob-search-btn { display: none; background: none; border: none; color: white; font-size: 18px; padding: 5px; }
        
        /* Modals and Overlays hidden by default */
        .shorts-modal, .watch-page, .voice-overlay, .mob-search { display: none; }

        /* --- REUSED STYLES FOR MODALS (Keeping it compact) --- */
        .shorts-modal { position: fixed; inset: 0; background: #000; z-index: 7000; justify-content: center; align-items: center; }
        .shorts-container { width: 100%; height: 100%; max-width: 480px; position: relative; background: #000; display: flex; flex-direction: column; }
        .shorts-frame { width: 100%; height: 100%; border: none; object-fit: cover; }
        .close-shorts { position: absolute; top: 15px; left: 15px; width: 40px; height: 40px; background: rgba(0,0,0,0.3); border-radius: 50%; display: grid; place-items: center; color: white; font-size: 20px; cursor: pointer; z-index: 10; }
        
        .watch-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 5000; overflow-y: auto; flex-direction: column; }
        .video-frame { width: 100%; aspect-ratio: 16/9; background: black; position: sticky; top: 0; z-index: 50; }
        .watch-content { padding: 15px; max-width: 1000px; margin: 0 auto; width: 100%; }
        .close-wp { position: fixed; top: 10px; right: 10px; z-index: 6000; background: rgba(0,0,0,0.6); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-weight: bold; cursor: pointer; }

        .mob-search { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 4000; flex-direction: column; }
        .ms-head { display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #333; gap: 10px; }
        .ms-input { flex: 1; background: #222; border: none; padding: 8px 15px; border-radius: 20px; color: white; height: 36px; outline: none; }
    </style>
</head>
<body>

    <!-- HIDDEN FILE INPUT -->
    <input type="file" id="fileUpload" accept="image/*" style="display: none;" onchange="previewImage(event)">

    <!-- HEADER -->
    <header>
        <div class="left">
            <i class="fas fa-bars menu-btn"></i>
            <!-- CLICKING LOGO REFRESHES PAGE -->
            <div class="brand" onclick="location.reload()" title="Refresh All">
                <img src="https://i.supaimg.com/f25eb9da-5856-46df-acba-182641a77cc9.png" class="logo-img" alt="Logo">
                <div class="maker-badge">MADE BY FAIZAN AHMED</div>
            </div>
        </div>
        <div class="search-wrap">
            <div class="search-box">
                <input type="text" id="dSearch" placeholder="Search">
                <button class="search-btn" onclick="execSearch('dSearch')"><i class="fas fa-search"></i></button>
            </div>
            <button class="mic-btn" onclick="startVoice('dSearch')"><i class="fas fa-microphone"></i></button>
        </div>
        <div class="right">
            <button class="mob-search-btn" onclick="openMobSearch()"><i class="fas fa-search"></i></button>
            <button class="icon-btn" onclick="alert('Upload')"><i class="fas fa-video"></i></button>
            <div class="avatar" onclick="triggerUpload()">F</div>
        </div>
    </header>

    <!-- BOTTOM NAV: Home Button Now Randomizes -->
    <nav class="bottom-nav">
        <button class="nav-btn active" onclick="goHome(this)"><i class="fas fa-home"></i><span>Home</span></button>
        <button class="nav-btn" onclick="loadCat('Shorts', this)"><i class="fas fa-bolt"></i><span>Shorts</span></button>
        <button class="nav-btn" onclick="alert('Create')"><i class="fas fa-plus-circle" style="font-size:32px;"></i></button>
        <button class="nav-btn" onclick="loadCat('Subscriptions', this)"><i class="fas fa-photo-video"></i><span>Subs</span></button>
        <button class="nav-btn" onclick="triggerUpload()"><i class="fas fa-user"></i><span>You</span></button>
    </nav>

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <a href="#" class="side-item active" onclick="goHome()"><i class="fas fa-home"></i> Home</a>
        <a href="#" class="side-item" onclick="loadCat('Shorts')"><i class="fas fa-bolt"></i> Shorts</a>
        <a href="#" class="side-item" onclick="loadCat('Subscriptions')"><i class="fas fa-photo-video"></i> Subscriptions</a>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main">
        <div class="chips">
            <button class="chip active" onclick="goHome(this)">All</button>
            <button class="chip" onclick="loadCat('New Songs 2024', this)">Music</button>
            <button class="chip" onclick="loadCat('Gaming Funny', this)">Gaming</button>
            <button class="chip" onclick="loadCat('Pakistani Vlogs', this)">Vlogs</button>
            <button class="chip" onclick="loadCat('Cricket Highlights', this)">Cricket</button>
            <button class="chip" onclick="loadCat('Tech Reviews', this)">Tech</button>
        </div>

        <!-- SHORTS SHELF -->
        <div class="shorts-container-home">
            <div class="shorts-head">
                <i class="fas fa-bolt shorts-logo-icon"></i> Shorts
            </div>
            <div class="shorts-shelf" id="shortsShelf"></div>
        </div>

        <div class="grid" id="grid"></div>
    </main>

    <!-- SHORTS PLAYER MODAL -->
    <div class="shorts-modal" id="shortsModal">
        <div class="shorts-container">
            <iframe id="shortsFrame" class="shorts-frame" src="" allow="autoplay; encrypted-media; loop"></iframe>
            <div class="close-shorts" onclick="closeShorts()"><i class="fas fa-arrow-left"></i></div>
            <div style="position:absolute; bottom:20px; left:10px; color:white; font-weight:bold; text-shadow:0 1px 2px black;">
                <div id="stTitle">Shorts Video</div>
            </div>
        </div>
    </div>

    <!-- WATCH PAGE -->
    <div class="watch-page" id="watchPage">
        <button class="close-wp" onclick="closeWatch()">✕</button>
        <iframe class="video-frame" id="vidFrame" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <div class="watch-content">
            <div style="font-size:18px; font-weight:700; margin-bottom:10px;" id="wpTitle">Title</div>
            <div style="margin-bottom:20px; color:#aaa;" id="wpMeta">Views • Time</div>
            <hr style="border:1px solid #333; margin-bottom:20px;">
            <div id="recsGrid"></div>
        </div>
    </div>

    <!-- MOBILE SEARCH -->
    <div class="mob-search" id="mobSearch">
        <div class="ms-head">
            <button class="icon-btn" onclick="closeMobSearch()"><i class="fas fa-arrow-left"></i></button>
            <input type="text" class="ms-input" id="mSearch" placeholder="Search...">
        </div>
    </div>

    <script>
        const API = "https://api.xyro.site/search/youtube?q=";
        const grid = document.getElementById('grid');

        // --- NEW: LIST OF RANDOM TOPICS FOR REFRESH ---
        const refreshTopics = [
            "Trending Videos 2025", "Viral Funny Clips", "New Music Hits Global", 
            "Most Popular Vlogs Today", "Amazing Science Facts", "World News Live", 
            "Top 10 Cricket Moments", "Best Gaming Moments", "New Movie Trailers",
            "Satisfying Videos", "Street Food World", "Technology News"
        ];

        // --- 1. INITIAL LOAD & REFRESH LOGIC ---
        window.onload = function() {
            // Pick a random topic on load
            goHome(); 
            loadShorts();
        };

        // Function to shuffle content (Home Button Logic)
        function goHome(btn) {
            // Get random index
            const randomTopic = refreshTopics[Math.floor(Math.random() * refreshTopics.length)];
            console.log("Refreshing with:", randomTopic); // Debug
            loadCat(randomTopic, btn);
            
            // Highlight 'All' chip if button not passed
            if(!btn) {
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                document.querySelector('.chip').classList.add('active');
            }
        }

        // --- 2. DATA FETCHING ---
        async function loadCat(query, btn) {
            // Reset Views
            document.getElementById('shortsModal').style.display = 'none';
            document.getElementById('shortsFrame').src = "";
            document.getElementById('watchPage').style.display = 'none';
            document.getElementById('vidFrame').src = "";
            document.getElementById('mobSearch').style.display = 'none';
            window.scrollTo(0,0);

            // Active Class UI
            if(btn) { 
                document.querySelectorAll('.chip, .nav-btn, .side-item').forEach(e=>e.classList.remove('active')); 
                btn.classList.add('active'); 
            }

            // Show Skeleton/Loading
            grid.innerHTML = '';
            for(let i=0; i<6; i++) grid.innerHTML += `<div class="card"><div class="thumb" style="background:#222;"></div><div style="height:40px; background:#222; margin-top:10px;"></div></div>`;

            if(query === 'Shorts') return; // Shorts are separate

            try {
                const res = await fetch(API + encodeURIComponent(query));
                const json = await res.json();
                const videos = json.result || json.data || [];
                
                grid.innerHTML = ''; // Clear skeleton

                if(!videos.length) { 
                    grid.innerHTML = '<p style="padding:20px;">Server Busy. Try Refresh.</p>'; 
                    return; 
                }

                // Shuffle the array from API for extra randomness
                const shuffled = videos.sort(() => 0.5 - Math.random());

                shuffled.forEach(v => {
                    let vidId = null;
                    if(v.link && v.link.includes('v=')) vidId = v.link.split('v=')[1].split('&')[0];
                    if(vidId) {
                        const title = v.title || "Unknown Title";
                        const chn = v.channel || "Zootube Channel";
                        const thumb = v.imageUrl || `https://i.ytimg.com/vi/${vidId}/hq720.jpg`;
                        const views = (Math.random()*5 + 0.1).toFixed(1) + "M views";
                        const time = Math.floor(Math.random()*23 + 1) + " hours ago";

                        const div = document.createElement('div');
                        div.className = 'card';
                        div.onclick = () => openWatch(vidId, title, chn, views, time);
                        div.innerHTML = `
                            <div class="thumb">
                                <img src="${thumb}">
                                <div class="duration">8:00</div>
                            </div>
                            <div class="meta">
                                <div class="chn-ico">${chn.charAt(0)}</div>
                                <div class="info">
                                    <div class="title">${title}</div>
                                    <div class="sub-txt">${chn} • ${views} • ${time}</div>
                                </div>
                            </div>
                        `;
                        grid.appendChild(div);
                    }
                });
            } catch(e) {
                grid.innerHTML = '<p style="padding:20px;">Connection Error. Refresh.</p>';
            }
        }

        // --- 3. SHORTS LOGIC ---
        function loadShorts() {
            // Random set of shorts to simulate refresh
            const allShorts = [
                {id: "KBtk5FUeJbk", t: "Art Skills"}, {id: "Z6aJZ0J1qgQ", t: "Funny Clip"},
                {id: "t_jHrUE5IOk", t: "Music Hit"}, {id: "PrpLsuF8jMw", t: "Cute Cat"},
                {id: "8_pM9_t8j0k", t: "Cricket Six"}, {id: "WdGk8S-gG-0", t: "Satisfying"},
                {id: "OpdJD3p3cZw", t: "Cool Tech"}, {id: "Jk5F6gT8h7s", t: "Dance Move"}
            ];
            // Shuffle Shorts
            const sList = allShorts.sort(() => 0.5 - Math.random()).slice(0, 6);
            
            const shelf = document.getElementById('shortsShelf');
            shelf.innerHTML = '';
            sList.forEach(s => {
                shelf.innerHTML += `
                    <div class="short-card" onclick="openShorts('${s.id}', '${s.t}')">
                        <img src="https://i.ytimg.com/vi/${s.id}/hq720.jpg" class="short-img">
                        <div class="short-overlay-grad"></div>
                        <div class="views-cnt">1.2M views</div>
                        <div class="short-title">${s.t}</div>
                    </div>
                `;
            });
        }

        function openShorts(id, title) {
            document.getElementById('stTitle').innerText = title;
            document.getElementById('shortsFrame').src = `https://www.youtube.com/embed/${id}?autoplay=1&loop=1&playlist=${id}&controls=0&modestbranding=1&rel=0`;
            document.getElementById('shortsModal').style.display = 'flex';
        }
        function closeShorts() {
            document.getElementById('shortsModal').style.display = 'none';
            document.getElementById('shortsFrame').src = "";
        }

        // --- 4. WATCH PAGE LOGIC ---
        function openWatch(id, title, chn, views, time) {
            document.getElementById('wpTitle').innerText = title;
            document.getElementById('wpMeta').innerText = `${chn} • ${views} • ${time}`;
            document.getElementById('vidFrame').src = `https://www.youtube.com/embed/${id}?autoplay=1`;
            document.getElementById('watchPage').style.display = 'flex';
            
            // Dummy Recs
            const recs = document.getElementById('recsGrid');
            recs.innerHTML = '';
            for(let i=0; i<5; i++){
                recs.innerHTML += `<div style="display:flex; gap:10px; margin-bottom:10px; cursor:pointer;" onclick="alert('Demo Video')">
                    <div style="width:120px; height:68px; background:#333; border-radius:8px;"></div>
                    <div style="font-size:14px; flex:1;">Up Next Video Title...<br><span style="font-size:12px; color:#aaa;">Channel Name</span></div>
                </div>`;
            }
        }
        function closeWatch() {
            document.getElementById('watchPage').style.display = 'none';
            document.getElementById('vidFrame').src = "";
        }

        // --- 5. UTILS ---
        function openMobSearch() { document.getElementById('mobSearch').style.display = 'flex'; document.getElementById('mSearch').focus(); }
        function closeMobSearch() { document.getElementById('mobSearch').style.display = 'none'; }
        function execSearch(id) {
            const val = document.getElementById(id).value;
            if(val) { closeMobSearch(); loadCat(val); }
        }
        function triggerUpload() { document.getElementById('fileUpload').click(); }
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.querySelectorAll('.avatar').forEach(a => {
                        a.innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">`;
                    });
                };
                reader.readAsDataURL(file);
            }
        }
    </script>
</body>
</html>
