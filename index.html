<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zootube | Full Video Player</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- 1. VARIABLES --- */
        :root {
            --bg-body: #000000;
            --bg-surface: #121212;
            --primary: #ff0000;
            --gold: #FFD700;
            --text-main: #ffffff;
            --text-sec: #aaaaaa;
            --border: rgba(255,255,255,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-body); color: var(--text-main); overflow-x: hidden; padding-bottom: 60px; }
        
        /* Hide Scrollbar */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* --- 2. LOADER --- */
        .spinner-box {
            width: 100%; height: 300px; display: flex; justify-content: center; align-items: center;
        }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);} }

        /* --- 3. HEADER --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 54px;
            background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px; z-index: 1000; border-bottom: 1px solid var(--border);
        }
        .left-sec { display: flex; align-items: center; gap: 12px; }
        .brand-box { display: flex; flex-direction: column; justify-content: center; cursor: pointer; }
        .logo-img { height: 22px; width: auto; object-fit: contain; }
        .maker-tag { font-size: 7px; color: var(--gold); font-weight: 900; letter-spacing: 0.5px; text-transform: uppercase; margin-top: 2px; }

        .search-bar { flex: 1; max-width: 500px; margin: 0 20px; display: flex; align-items: center; gap: 10px; }
        .input-wrap { display: flex; width: 100%; background: #121212; border: 1px solid #333; border-radius: 40px; overflow: hidden; height: 38px; align-items: center; }
        .input-wrap input { flex: 1; background: transparent; border: none; color: white; padding: 0 16px; font-size: 15px; outline: none; }
        .mic-btn { width: 38px; height: 38px; background: #121212; border-radius: 50%; border: none; color: white; display: flex; align-items: center; justify-content: center; }
        
        .right-sec { display: flex; align-items: center; gap: 15px; }
        .mob-search-btn { background: none; border: none; color: white; font-size: 18px; padding: 5px; cursor: pointer; }
        .user-pic { width: 30px; height: 30px; border-radius: 50%; background: purple; color: white; display: grid; place-items: center; font-weight: bold; font-size: 12px; cursor: pointer; border: 1px solid #fff; }

        /* --- 4. NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background: #000; border-top: 1px solid var(--border);
            z-index: 2000; display: flex; justify-content: space-around; align-items: center;
        }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #888; background: none; border: none; width: 100%; padding: 5px; cursor: pointer; transition: 0.2s; }
        .nav-btn.active { color: white; }
        .nav-btn i { font-size: 22px; } .nav-btn span { font-size: 10px; }

        .sidebar { width: 220px; position: fixed; top: 54px; left: 0; bottom: 0; background: #000; overflow-y: auto; padding: 12px; }
        .side-link { display: flex; align-items: center; gap: 20px; padding: 10px 12px; color: white; border-radius: 10px; font-size: 14px; margin-bottom: 2px; cursor: pointer; }
        .side-link.active { background: var(--bg-hover); font-weight: 500; }

        /* --- 5. MAIN CONTENT --- */
        .main-content { margin-left: 220px; margin-top: 54px; padding: 15px; min-height: 100vh; }
        .tags-bar { position: sticky; top: 54px; background: rgba(0,0,0,0.95); z-index: 90; padding: 10px 0; margin-bottom: 15px; overflow-x: auto; white-space: nowrap; display: flex; gap: 10px; }
        .tag { background: var(--bg-surface); color: white; border: 1px solid #333; padding: 6px 14px; border-radius: 8px; font-size: 13px; font-weight: 500; cursor: pointer; transition: 0.2s; }
        .tag.active { background: white; color: black; border-color: white; }

        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }

        /* --- 6. CARDS --- */
        .card { cursor: pointer; display: flex; flex-direction: column; gap: 10px; }
        .thumb-box { position: relative; width: 100%; aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; background: #222; }
        .thumb-img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.3s; }
        .thumb-img.loaded { opacity: 1; }
        .time-label { position: absolute; bottom: 6px; right: 6px; background: rgba(0,0,0,0.8); color: white; font-size: 11px; padding: 2px 4px; border-radius: 4px; font-weight: 700; }
        .meta-info { display: flex; gap: 12px; }
        .chn-avatar { width: 36px; height: 36px; border-radius: 50%; background: #333; flex-shrink: 0; display: grid; place-items: center; font-size: 14px; z-index: 2; border: 1px solid transparent; }
        .chn-avatar:hover { border-color: white; transform: scale(1.1); }
        .text-info { display: flex; flex-direction: column; }
        .vid-title { font-size: 14px; font-weight: 500; line-height: 1.3; color: white; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 3px; }
        .vid-stats { font-size: 12px; color: var(--text-sec); }

        /* --- 7. SHORTS (SMART AUDIO FIX) --- */
        .shorts-container { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1500; overflow-y: scroll; scroll-snap-type: y mandatory; }
        .short-item { position: relative; width: 100%; height: calc(100vh - 60px); scroll-snap-align: start; background: #000; display: flex; justify-content: center; align-items: center; border-bottom: 1px solid #111; }
        .short-iframe { width: 100%; height: 100%; border: none; object-fit: cover; }
        .short-actions { position: absolute; right: 10px; bottom: 100px; display: flex; flex-direction: column; gap: 20px; align-items: center; z-index: 10; }
        .icon-circle { width: 45px; height: 45px; background: rgba(255,255,255,0.15); border-radius: 50%; display: grid; place-items: center; backdrop-filter: blur(5px); }
        .short-overlay { position: absolute; left: 15px; bottom: 20px; width: 75%; pointer-events: none; z-index: 10; }
        .short-user { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; pointer-events: auto; }
        .short-sub-btn { background: white; color: black; border: none; padding: 4px 12px; border-radius: 4px; font-weight: bold; font-size: 12px; cursor: pointer; }

        /* --- 8. CHANNEL PAGE --- */
        .channel-page { display: none; flex-direction: column; width: 100%; height: 100%; overflow-y: auto; padding-bottom: 70px; background: #0f0f0f; }
        .channel-header { padding: 0 0 10px 0; border-bottom: 1px solid #333; margin-bottom: 10px; }
        .banner { width: 100%; height: 120px; background: linear-gradient(45deg, #222, #444); }
        .chn-profile { display: flex; align-items: flex-end; gap: 15px; padding: 0 15px; margin-top: -35px; }
        .chn-lg-img { width: 75px; height: 75px; border-radius: 50%; background: purple; border: 4px solid #0f0f0f; display: grid; place-items: center; font-size: 28px; color: white; font-weight: bold;}
        .back-btn { background: rgba(0,0,0,0.6); color: white; border: none; padding: 8px 15px; border-radius: 20px; margin: 10px; display: inline-flex; align-items: center; gap: 5px; cursor: pointer; position: absolute; top: 60px; left: 10px; z-index: 50; }

        /* --- 9. MINI PLAYER --- */
        .mini-player {
            position: fixed; bottom: 65px; right: 20px; width: 300px; height: 60px;
            background: #222; border-radius: 10px; display: none; align-items: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.8); z-index: 5000; overflow: hidden;
            border: 1px solid #333; cursor: pointer;
        }
        .mini-vid { width: 100px; height: 100%; background: black; }
        .mini-info { flex: 1; padding: 0 10px; display: flex; flex-direction: column; justify-content: center; }
        .mini-title { font-size: 12px; font-weight: bold; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; color: white; }
        .mini-chn { font-size: 10px; color: #aaa; }
        .mini-controls { padding-right: 15px; }

        /* --- 10. UPLOAD MODAL --- */
        .upload-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 6000; display: none;
            justify-content: center; align-items: center; flex-direction: column;
        }
        .upload-box { background: #1e1e1e; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; }
        .upload-icon { font-size: 50px; color: #3ea6ff; margin-bottom: 20px; }
        .progress-bar { width: 100%; height: 6px; background: #333; border-radius: 3px; margin-top: 20px; overflow: hidden; display: none; }
        .progress-fill { height: 100%; background: #3ea6ff; width: 0%; transition: width 0.1s linear; }
        .file-input { display: none; }
        .upload-btn { background: #3ea6ff; color: black; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; margin-top: 10px; }

        /* --- 11. FULL PLAYER --- */
        .player-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 6000; flex-direction: column; overflow-y: auto; }
        /* Adjusted Video Frame to be responsive and full width */
        .vid-frame-box { 
            width: 100%; 
            position: sticky; top: 0; z-index: 100;
            background: black;
            /* Default aspect ratio, can be overridden by specific video needs */
            aspect-ratio: 16/9; 
        }
        .p-content { padding: 15px; padding-bottom: 80px; }
        .p-actions { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; border-bottom: 1px solid #222; }
        .pill-btn { background: #222; color: white; border: none; padding: 8px 16px; border-radius: 20px; font-size: 13px; display: flex; align-items: center; gap: 6px; white-space: nowrap; cursor: pointer; }

        /* Overlays */
        .search-ui { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f0f0f; z-index: 3000; display: none; flex-direction: column; }
        .s-head { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #333; gap: 10px; }
        .s-inp { flex: 1; background: #222; border: none; padding: 10px; border-radius: 20px; color: white; outline: none; }
        
        /* Toast */
        .toast { position: fixed; bottom: 80px; left: 50%; transform: translate(-50%, 20px); background: #333; color: white; padding: 10px 20px; border-radius: 25px; opacity: 0; transition: 0.3s; z-index: 7000; pointer-events: none; }
        .toast.show { opacity: 1; transform: translate(-50%, 0); }

        @media (max-width: 768px) {
            header { padding: 0 10px; height: 50px; }
            .menu-btn, .search-bar, .sidebar { display: none; }
            .main-content { margin-left: 0; margin-top: 50px; padding: 10px; }
            .tags-bar { top: 50px; }
            .bottom-nav { display: flex; }
            .video-grid { grid-template-columns: 1fr; gap: 20px; }
            .mob-search-btn { display: block !important; }
            .shorts-container { top: 50px; height: calc(100vh - 110px); }
            .mini-player { width: 100%; right: 0; bottom: 60px; border-radius: 0; border: none; border-top: 1px solid #333; }
        }
        .mob-search-btn { display: none; }
    </style>
</head>
<body>

    <!-- TOAST -->
    <div class="toast" id="toast">Notification</div>

    <!-- UPLOAD MODAL -->
    <div class="upload-modal" id="uploadModal">
        <div class="upload-box">
            <i class="fas fa-cloud-upload-alt upload-icon"></i>
            <h3>Upload Video</h3>
            <p style="color:#aaa; font-size:13px; margin-bottom:20px;">Select a video file from your device</p>
            <input type="file" id="fileInp" class="file-input" accept="video/*" onchange="startUpload()">
            <button class="upload-btn" onclick="document.getElementById('fileInp').click()">Select File</button>
            <button class="upload-btn" style="background:#333; color:white;" onclick="closeUpload()">Cancel</button>
            <div class="progress-bar" id="progBar"><div class="progress-fill" id="progFill"></div></div>
            <p id="uploadStatus" style="margin-top:10px; font-size:12px; color:#aaa;"></p>
        </div>
    </div>

    <!-- MINI PLAYER -->
    <div class="mini-player" id="miniPlayer" onclick="maximizePlayer()">
        <div class="mini-vid"><iframe id="miniFrame" style="width:100%;height:100%;border:none;pointer-events:none;"></iframe></div>
        <div class="mini-info"><div class="mini-title" id="miniTitle">Title</div><div class="mini-chn" id="miniChn">Channel</div></div>
        <div class="mini-controls"><button onclick="event.stopPropagation(); closeMiniPlayer()" style="background:none;border:none;color:white;font-size:16px;"><i class="fas fa-times"></i></button></div>
    </div>

    <!-- HEADER -->
    <header id="appHeader">
        <div class="left-sec">
            <div class="brand-box" onclick="goHome()">
                <img src="https://i.supaimg.com/f25eb9da-5856-46df-acba-182641a77cc9.png" class="logo-img" alt="Logo">
                <div class="maker-tag">MADE BY FAIZAN AHMED</div>
            </div>
        </div>
        <div class="search-bar">
            <div class="input-wrap"><input type="text" id="dSearch" placeholder="Search"><button style="background:none;border:none;color:#aaa;" onclick="execSearch('dSearch')"><i class="fas fa-search"></i></button></div>
            <button class="mic-btn" onclick="openVoice()"><i class="fas fa-microphone"></i></button>
        </div>
        <div class="right-sec">
            <button class="mob-search-btn" onclick="openSearchUI()"><i class="fas fa-search"></i></button>
            <div class="user-pic">F</div>
        </div>
    </header>

    <!-- NAV -->
    <nav class="bottom-nav">
        <div class="nav-btn active" onclick="goHome()"><i class="fas fa-home"></i> <span>Home</span></div>
        <div class="nav-btn" onclick="openShorts()"><i class="fas fa-bolt"></i> <span>Shorts</span></div>
        <div class="nav-btn" onclick="openUpload()"><i class="fas fa-plus-circle" style="font-size:32px;color:white;"></i></div>
        <div class="nav-btn" onclick="loadCat('Subscriptions', this)"><i class="fas fa-photo-video"></i> <span>Subs</span></div>
        <div class="nav-btn" onclick="loadCat('Library', this)"><i class="fas fa-folder"></i> <span>Library</span></div>
    </nav>

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="side-link active" onclick="goHome()"><i class="fas fa-home"></i> Home</div>
        <div class="side-link" onclick="openShorts()"><i class="fas fa-bolt"></i> Shorts</div>
        <div class="side-link" onclick="loadCat('History')"><i class="fas fa-history"></i> History</div>
    </aside>

    <!-- HOME VIEW -->
    <div id="homeView" class="main-content">
        <div class="tags-bar">
            <button class="tag active" onclick="loadCat('Trending', this)">All</button>
            <button class="tag" onclick="loadCat('Pakistani Dramas', this)">Dramas</button>
            <button class="tag" onclick="loadCat('Music 2025', this)">Music</button>
            <button class="tag" onclick="loadCat('Gaming', this)">Gaming</button>
            <button class="tag" onclick="loadCat('Cricket', this)">Cricket</button>
        </div>
        <div class="video-grid" id="grid"></div>
    </div>

    <!-- SHORTS VIEW -->
    <div id="shortsView" class="shorts-container"></div>

    <!-- CHANNEL VIEW -->
    <div id="channelView" class="channel-page" style="margin-top: 50px;">
        <button class="back-btn" onclick="goHome()"><i class="fas fa-arrow-left"></i> Home</button>
        <div class="channel-header">
            <div class="banner"></div>
            <div class="chn-profile">
                <div class="chn-lg-img" id="chnPic">C</div>
                <div style="flex:1;"><h2 id="chnName" style="font-size:22px; margin:0;">Channel</h2><p style="color:#aaa; font-size:12px;">1.5M Subscribers</p></div>
            </div>
        </div>
        <div class="video-grid" id="chnGrid" style="padding:10px;"></div>
    </div>

    <!-- PLAYER -->
    <div class="player-modal" id="playerModal">
        <div class="vid-frame-box"><iframe id="pFrame" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>
        <div class="p-content">
            <div style="display:flex; justify-content:space-between;">
                <div><div id="pTitle" style="font-size:16px; font-weight:bold; margin-bottom:5px;">Title</div><div style="font-size:12px; color:#aaa;">1.2M Views • 2 days ago</div></div>
                <i class="fas fa-chevron-down" style="padding:10px; cursor:pointer;" onclick="minimizePlayer()"></i>
            </div>
            <div style="display:flex; align-items:center; gap:10px; margin:15px 0;">
                <div id="pChnPic" style="width:36px; height:36px; background:#444; border-radius:50%; display:grid; place-items:center;">C</div>
                <div style="font-weight:bold; font-size:14px; flex:1;" id="pChnName">Channel</div>
                <button style="background:white; color:black; border:none; padding:6px 14px; border-radius:20px; font-weight:bold;">Subscribe</button>
            </div>
            <div class="p-actions">
                <button class="pill-btn"><i class="fas fa-thumbs-up"></i> Like</button>
                <button class="pill-btn"><i class="fas fa-share"></i> Share</button>
                <button class="pill-btn"><i class="fas fa-download"></i> Download</button>
            </div>
        </div>
    </div>

    <!-- SEARCH UI -->
    <div class="search-ui" id="searchUI">
        <div class="s-head">
            <button onclick="closeSearchUI()" style="background:none; border:none; color:white;"><i class="fas fa-arrow-left"></i></button>
            <input type="text" class="s-inp" id="mSearch" placeholder="Search...">
        </div>
    </div>

    <script>
        const API = "https://api.xyro.site/search/youtube?q=";
        const grid = document.getElementById('grid');
        const shortsBox = document.getElementById('shortsView');
        let currentVideo = {};

        /* --- RANDOM TOPICS --- */
        const topics = ["Latest Vlogs", "Technology 2025", "Funny Videos", "Cricket Highlights", "Travel Pakistan", "Food Reviews"];
        const shortsTopics = ["Funny Shorts", "Viral TikToks", "Cricket Moments Shorts", "Satisfying Shorts"];

        window.onload = () => {
            const rand = topics[Math.floor(Math.random() * topics.length)];
            loadCat(rand);
        };

        /* --- SMART AUDIO FIX (OBSERVER) --- */
        let observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                let iframe = entry.target.querySelector('iframe');
                let vidId = entry.target.getAttribute('data-id');
                if (entry.isIntersecting) {
                    if(!iframe.src) iframe.src = `https://www.youtube.com/embed/${vidId}?autoplay=1&controls=0&modestbranding=1&loop=1&playlist=${vidId}&rel=0`;
                } else {
                    iframe.removeAttribute('src');
                }
            });
        }, { root: shortsBox, threshold: 0.6 });

        /* --- UPLOAD SIMULATION --- */
        function openUpload() { document.getElementById('uploadModal').style.display = 'flex'; }
        function closeUpload() { document.getElementById('uploadModal').style.display = 'none'; document.getElementById('progBar').style.display = 'none'; document.getElementById('progFill').style.width = '0%'; document.getElementById('uploadStatus').innerText = '';}
        
        function startUpload() {
            const bar = document.getElementById('progBar');
            const fill = document.getElementById('progFill');
            const status = document.getElementById('uploadStatus');
            bar.style.display = 'block';
            status.innerText = 'Uploading...';
            
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                    status.innerText = 'Upload Complete! Processing...';
                    setTimeout(() => {
                        closeUpload();
                        showToast("Video Uploaded Successfully!");
                    }, 1000);
                } else {
                    width += 5;
                    fill.style.width = width + '%';
                }
            }, 100);
        }

        /* --- NAVIGATION --- */
        function hideAll() { document.querySelectorAll('.main-content, .shorts-container, .channel-page').forEach(el => el.style.display = 'none'); }
        function goHome() {
            hideAll();
            document.getElementById('homeView').style.display = 'block';
            document.getElementById('appHeader').style.display = 'flex';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.nav-btn')[0].classList.add('active');
            shortsBox.innerHTML = ''; // Stop shorts
        }

        /* --- LOAD VIDEOS --- */
        async function loadCat(query, btn) {
            goHome();
            if(btn) {
                document.querySelectorAll('.tag, .nav-btn').forEach(e => e.classList.remove('active'));
                btn.classList.add('active');
            }
            grid.innerHTML = '<div class="spinner-box"><div class="spinner"></div></div>';
            try {
                const res = await fetch(API + encodeURIComponent(query));
                const json = await res.json();
                let videos = json.result || json.data || [];
                videos = videos.sort(() => Math.random() - 0.5);
                renderGrid(videos, grid);
            } catch(e) { grid.innerHTML = '<p style="padding:20px;">Error.</p>'; }
        }

        function renderGrid(videos, container) {
            container.innerHTML = '';
            videos.forEach(v => {
                let vidId = null;
                if(v.link && v.link.includes('v=')) vidId = v.link.split('v=')[1].split('&')[0];
                if(vidId) {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.onclick = () => playVideo(vidId, v.title, v.channel);
                    card.innerHTML = `
                        <div class="thumb-box"><img src="https://i.ytimg.com/vi/${vidId}/hq720.jpg" class="thumb-img" onload="this.classList.add('loaded')"><div class="time-label">10:00</div></div>
                        <div class="meta-info">
                            <div class="chn-avatar">${v.channel.charAt(0)}</div>
                            <div class="text-info"><div class="vid-title">${v.title}</div><div class="vid-stats">${v.channel} • 500K views</div></div>
                        </div>`;
                    card.querySelector('.chn-avatar').onclick = (e) => { e.stopPropagation(); openChannel(v.channel); };
                    container.appendChild(card);
                }
            });
        }

        /* --- CHANNEL --- */
        async function openChannel(name) {
            hideAll();
            document.getElementById('channelView').style.display = 'flex';
            document.getElementById('chnName').innerText = name;
            document.getElementById('chnPic').innerText = name.charAt(0);
            const cGrid = document.getElementById('chnGrid');
            cGrid.innerHTML = '<div class="spinner-box"><div class="spinner"></div></div>';
            try {
                const res = await fetch(API + encodeURIComponent(name));
                const json = await res.json();
                renderGrid(json.result || [], cGrid);
            } catch(e) {}
        }

        /* --- SHORTS --- */
        async function openShorts() {
            hideAll();
            document.getElementById('shortsView').style.display = 'block';
            document.getElementById('appHeader').style.display = 'none';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.nav-btn')[1].classList.add('active');
            shortsBox.innerHTML = '<div class="spinner-box"><div class="spinner"></div></div>';
            closeMiniPlayer();

            const rand = shortsTopics[Math.floor(Math.random() * shortsTopics.length)];
            try {
                const res = await fetch(API + encodeURIComponent(rand));
                const json = await res.json();
                renderShorts(json.result || []);
            } catch(e) {}
        }

        function renderShorts(videos) {
            shortsBox.innerHTML = '';
            videos.forEach(v => {
                let vidId = v.link.split('v=')[1].split('&')[0];
                const item = document.createElement('div');
                item.className = 'short-item';
                item.setAttribute('data-id', vidId);
                item.innerHTML = `
                    <iframe class="short-iframe" style="width:100%;height:100%;border:none;object-fit:cover;" allow="autoplay"></iframe>
                    <div class="short-actions">
                        <div class="icon-circle"><i class="fas fa-thumbs-up"></i></div>
                        <div class="icon-circle"><i class="fas fa-share"></i></div>
                    </div>
                    <div class="short-overlay">
                        <div class="short-user"><div class="short-user-img" style="background:#fff;"></div><div class="short-username">${v.channel}</div><button class="short-sub-btn">Subscribe</button></div>
                        <div class="short-desc">${v.title}</div>
                    </div>`;
                shortsBox.appendChild(item);
                observer.observe(item);
            });
        }

        /* --- PLAYER --- */
        function playVideo(id, title, chn) {
            closeMiniPlayer();
            currentVideo = {id, title, chn};
            document.getElementById('pFrame').src = `https://www.youtube.com/embed/${id}?autoplay=1`;
            document.getElementById('pTitle').innerText = title;
            document.getElementById('pChnName').innerText = chn;
            document.getElementById('pChnPic').innerText = chn.charAt(0);
            document.getElementById('playerModal').style.display = 'flex';
        }
        function minimizePlayer() {
            document.getElementById('playerModal').style.display = 'none';
            document.getElementById('pFrame').src = "";
            document.getElementById('miniPlayer').style.display = 'flex';
            document.getElementById('miniTitle').innerText = currentVideo.title;
            document.getElementById('miniChn').innerText = currentVideo.chn;
            document.getElementById('miniFrame').src = `https://www.youtube.com/embed/${currentVideo.id}?autoplay=1&controls=0`;
        }
        function maximizePlayer() { playVideo(currentVideo.id, currentVideo.title, currentVideo.chn); }
        function closeMiniPlayer() { document.getElementById('miniPlayer').style.display = 'none'; document.getElementById('miniFrame').src = ""; }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function openSearchUI() { document.getElementById('searchUI').style.display = 'flex'; document.getElementById('mSearch').focus(); }
        function closeSearchUI() { document.getElementById('searchUI').style.display = 'none'; }
        function execSearch(id) { const val = document.getElementById(id).value; if(val) { if(id==='mSearch') closeSearchUI(); loadCat(val); } }
        document.getElementById('dSearch').addEventListener('keypress', (e)=>{if(e.key==='Enter') execSearch('dSearch')});
        document.getElementById('mSearch').addEventListener('keypress', (e)=>{if(e.key==='Enter') execSearch('mSearch')});
    </script>
</body>
</html>
